

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Data Manipulation &amp; Analysis in Python &#8212; Python for Experimental Chemistry</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ManipulatingData';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Visualizing Data in Python" href="plotting.html" />
    <link rel="prev" title="Importing Data into Python" href="ImportingData.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Python for Physical Chemistry
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ImportingData.html">Importing Data into Python</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Data Manipulation &amp; Analysis in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Visualizing Data in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="lmfit.html">Best Fits in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab_tutorial.html">(CHM223) Rotational-Vibrational Spectroscopy - Theory</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Rees9/Py4PhysChem" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Rees9/Py4PhysChem/issues/new?title=Issue%20on%20page%20%2FManipulatingData.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/ManipulatingData.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Data Manipulation & Analysis in Python</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#truncating-data-with-boolean-logic">Truncating data with boolean logic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-peaks-scipy-find-peaks">Finding peaks: scipy.find_peaks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background-subtraction">Background subtraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#normalization">Normalization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#flipping-data">Flipping data</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="data-manipulation-analysis-in-python">
<h1>Data Manipulation &amp; Analysis in Python<a class="headerlink" href="#data-manipulation-analysis-in-python" title="Permalink to this heading">#</a></h1>
<p>Now that we have imported data, often we want to use it to determine certain experimental observables. A peak wavelength from a UV/VIS spectra, a lifetime from concentration data, or chemical shift peaks in NMR. There are a multitude of ways to use this data to perform operations, and here we will just present a few.</p>
<p>Let’s start with some NMR data of Ag<span class="math notranslate nohighlight">\(_2\)</span>ZnSnS<span class="math notranslate nohighlight">\(_4\)</span> (AZTS) nanocrystals (<a class="reference external" href="https://chemrxiv.org/engage/chemrxiv/article-details/63e465cb3067856f18bc31f3">Yarur, F. <em>et al.</em> (Wilson), <strong>2023.</strong> <em>ChemRxiv</em></a>) labelled <code class="docutils literal notranslate"><span class="pre">D1</span> <span class="pre">AZTS</span> <span class="pre">crude.csv</span></code>, using our template from the Importing Data section. Remember though, first we should always just <em>open up the data</em> to see what it looks like to figure out how to import it</p>
<p><img alt="image.png" src="_images/nmr_data.png" /></p>
<p>What we can notice is that, despite being a .csv file, the data is not comma delimited. In fact, there’s just a space between each number. Now we know what parameters to pass to import properly!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### IMPORT AND ROUGH PLOT DATA</span>
<span class="c1"># Import packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># define where our file can be found to be imported</span>
<span class="n">filepath</span>        <span class="o">=</span> <span class="s1">&#39;data/D1 AZTS crude.csv&#39;</span>

<span class="c1"># label each variable something relevant to what it represents</span>
<span class="n">ppm</span><span class="p">,</span> <span class="n">signal</span>             <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span>           <span class="c1"># string, filepath to data</span>
                                 <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>       <span class="c1"># data is float</span>
                                 <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>      <span class="c1"># data is separated by spaces/tabs, so leave this blank</span>
                                 <span class="n">skip_header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>     <span class="c1"># when we look, data has no header, so we set this to zero</span>
                                 <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>       <span class="c1"># first column is ppm, second column is absorption</span>

<span class="c1"># print and plot data to try and look if data imported properly</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ppm = &#39;</span><span class="p">,</span><span class="n">ppm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;signal = &#39;</span><span class="p">,</span><span class="n">signal</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ppm</span><span class="p">,</span><span class="n">signal</span><span class="p">)</span> <span class="c1"># plt.plot(xvalues, yvalues);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ppm =  [-2.0181  -2.01786 -2.01761 ... 14.0179  14.0181  14.0184 ]
signal =  [-0.0377323 -0.0383906 -0.0410056 ...  0.0453818  0.0463226  0.0456263]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x1cc82430f48&gt;]
</pre></div>
</div>
<img alt="_images/0858c9bd1bffe2c6efed6c93a2b2b432f6049b56d8fc199041136ea8a5addeb5.png" src="_images/0858c9bd1bffe2c6efed6c93a2b2b432f6049b56d8fc199041136ea8a5addeb5.png" />
</div>
</div>
<p>Looks like an 1H NMR spectra—but, perhaps backwards!? This is because we did not include in the script any instructions to flip the x-axis left-to-right, which is the usual convention for 1H NMR spectra. We certainly could (and will below—as well as adding <em>e.g.</em> axis labels.) However, at this point we’re just aiming to see if our data import step worked correctly, and we wanted to make the broader point that it’s often wise to start with the simplest possible script to check that a critical step is working, and then build from there.</p>
<section id="truncating-data-with-boolean-logic">
<h2>Truncating data with boolean logic<a class="headerlink" href="#truncating-data-with-boolean-logic" title="Permalink to this heading">#</a></h2>
<div class="important admonition">
<p class="admonition-title">For CHM223 students</p>
<p>This subsection is relevant for your assignment!</p>
</div>
<p>While we can modify the limits of our plots to highlight specific regions of interest, we also might frequently want to truncate our data itself. For instance, truncation could be helpful if the overall data set is large and unwieldy and we’re only interested in a sub-region, or if we’re trying to normalize our data to a local extremum instead of an outlier that isn’t physically relevant (due to instrumentational limits/flaws, data corruption, etc.)</p>
<p>Luckily, python has easy ways for us to modify our data accordingly using <strong>boolean logic</strong> (For a refresher, check out computational assignment 1.) Given an array of values, we can check each one against a condition, such as being smaller than a certain number. This will return an array of the same size that contains the boolean values of either <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<p>Let’s use the NMR data above for example. Say we only care about data less than 10 ppm. We can check which values of our <code class="docutils literal notranslate"><span class="pre">ppm</span></code> (x-axis) array correspond to less than 10 ppm as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">print(ppm</span> <span class="pre">&lt;</span> <span class="pre">10)</span></code></p>
<p>which returns</p>
<p><code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">True</span> <span class="pre">True</span> <span class="pre">True</span> <span class="pre">True</span> <span class="pre">True</span> <span class="pre">...</span>&#160; <span class="pre">False</span> <span class="pre">False</span> <span class="pre">False</span> <span class="pre">False</span> <span class="pre">False]</span></code></p>
<p>This is useful because we can use this new array of boolean values to modify both of our original arrays, <code class="docutils literal notranslate"><span class="pre">ppm</span></code> (x-axis values) and <code class="docutils literal notranslate"><span class="pre">signal</span></code> (y values). This will keep those elements where the new boolean array has <code class="docutils literal notranslate"><span class="pre">true</span></code>, and discarding those where the condition returned <code class="docutils literal notranslate"><span class="pre">false</span></code>. We could then use these two, truncated arrays to generate another plot. See below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import data</span>
<span class="n">filepath</span>        <span class="o">=</span> <span class="s1">&#39;data/D1 AZTS crude.csv&#39;</span>
<span class="n">ppm</span><span class="p">,</span> <span class="n">signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plot our data, unmodified</span>
   <span class="c1">#As a variation, this time we&#39;re going to use the plt.subplots function to generate the figure. This is a python function for plotting with a somewhat-broader scope than plt.plot. For instance (as the name suggests) we could use it to make a single fiure with multiple sub-plots.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span> <span class="c1"># Generate figure and axes objects</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ppm</span><span class="p">,</span><span class="n">signal</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;original data&#39;</span><span class="p">,)</span> <span class="c1">#Add an axis with the original data</span>

<span class="c1"># modify the ppm and signal arrays to only include values where the signal is less than 10</span>
<span class="n">signal</span> <span class="o">=</span> <span class="n">signal</span><span class="p">[</span><span class="n">ppm</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">]</span>   <span class="c1"># first, modify the y values to correspond to when the x values are less than 10</span>
<span class="n">ppm</span> <span class="o">=</span> <span class="n">ppm</span><span class="p">[</span><span class="n">ppm</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">]</span>         <span class="c1"># then, modify the x values to correspond to when the x values are less than 10</span>

<span class="c1"># furthermore, we might also want to only include values where ppm is greater than 0</span>
<span class="n">signal</span> <span class="o">=</span> <span class="n">signal</span><span class="p">[</span><span class="n">ppm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>    <span class="c1"># first, modify the y values to correspond to when the x values are greater than 0</span>
<span class="n">ppm</span> <span class="o">=</span> <span class="n">ppm</span><span class="p">[</span><span class="n">ppm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>          <span class="c1"># then, modify the x values to correspond to when the x values are greater than 0</span>

<span class="c1"># add our truncated data to the plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ppm</span><span class="p">,</span><span class="n">signal</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;truncated data&#39;</span><span class="p">)</span> <span class="c1">#Add an additional (overlaying) axis with the truncated data</span>

<span class="c1"># modify plot appearance</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span> <span class="c1">#add the legend</span>
<span class="n">ax</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span> <span class="c1"># This _flips_ the x-axis left-to-right, which is the usual convention for 1H NMR spectra.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$\delta$ ppm&#39;</span><span class="p">)</span> <span class="c1">#label the x-axis</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;intensity (arb.)&#39;</span><span class="p">)</span> <span class="c1">#label the y-axis</span>

<span class="c1"># If we want to, we can also do the same truncation operations for an array of data as above, but with a single line of code</span>
<span class="c1"># the &amp; symbol (literally AND) allows us to use Boolean logic and consider multiple comparisons at once. The syntax requires that we put each nested comparison in parentheses. ()</span>
<span class="c1"># This time, we&#39;ll also generate new arrays for the truncated dataset. We can avoid confusion by giving them obvious variable names.</span>
<span class="n">ppm</span><span class="p">,</span> <span class="n">signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">truncsignal</span> <span class="o">=</span> <span class="n">signal</span><span class="p">[(</span><span class="n">ppm</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ppm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span> <span class="c1"># first, modify the y values to correspond to when the x values are less than 10 and greater than 0</span>
<span class="n">truncppm</span> <span class="o">=</span> <span class="n">ppm</span><span class="p">[(</span><span class="n">ppm</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ppm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span> <span class="c1"># then, modify the x values to correspond to when the x values are less than 10 and greater than 0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/92cdb11887557908455bc3e1eaa4df0109d060d783bdb0c1ed1be98c31ea0e04.png" src="_images/92cdb11887557908455bc3e1eaa4df0109d060d783bdb0c1ed1be98c31ea0e04.png" />
</div>
</div>
</section>
<section id="finding-peaks-scipy-find-peaks">
<h2>Finding peaks: scipy.find_peaks<a class="headerlink" href="#finding-peaks-scipy-find-peaks" title="Permalink to this heading">#</a></h2>
<div class="important admonition">
<p class="admonition-title">For CHM223 students</p>
<p>This subsection is relevant for your assignment!</p>
</div>
<p>scipy, like numpy or matplotlib, is another package for python that includes a large number of functions useful for science and data analysis. One of the many included is the function <code class="docutils literal notranslate"><span class="pre">find_peaks()</span></code>, which allows us to locate peaks in an array of values in order to determine their positions, not unlike in commercial FTIR software.</p>
<p>The function is used as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">peaks</span> <span class="pre">,</span> <span class="pre">_</span> <span class="pre">=</span> <span class="pre">scipy.find_peaks(data,</span> <span class="pre">height</span> <span class="pre">=</span> <span class="pre">x,</span> <span class="pre">width</span> <span class="pre">=</span> <span class="pre">y,</span> <span class="pre">prominence</span> <span class="pre">=</span> <span class="pre">z)</span></code></p>
<p>where the newly created array, <code class="docutils literal notranslate"><span class="pre">peaks</span></code>, will contain all the positions (i.e. indices) at which peaks were found in the original <code class="docutils literal notranslate"><span class="pre">data</span></code> array. For example, a value of <code class="docutils literal notranslate"><span class="pre">34</span></code> in one element of the <code class="docutils literal notranslate"><span class="pre">peaks</span></code> array would imply that there is a peak located at <code class="docutils literal notranslate"><span class="pre">data[34]</span></code>. (For those interested, the underscore in <code class="docutils literal notranslate"><span class="pre">,</span> <span class="pre">_</span></code> just instructs the computer to throw away all the other things that function returns. We do this here because we’re not interested in this other information, but keep in mind that common functions in python have many more capabilities in general than we often need for any particular case!</p>
<p>There are a few important controls for this function, which we can pass to the function as arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">height</span> <span class="pre">=</span></code> will specify a threshold for the minimum height of a peak. For instance, if we know the maximum level of our background signal, we can use this setting to avoid flagging incidental maxima that arise from a fluctuating background.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">width</span> <span class="pre">=</span></code> will specify the expected width between neighbouring peaks, which can be useful in avoiding identifying multiple sub-peaks on the same overall feature if we expect our data to be separate by more than some number of array elements.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prominence</span> <span class="pre">=</span></code> is a concept from topography is a bit more elusive to define, but is very useful becuase it can directly address (and exclude) shoulders or sub-peaks of a larger feature. In topography, the <em>prominence</em> of a peak is its elevation relative to the (highest) valley connecting it to a still-higher peak. Thus, when used in <code class="docutils literal notranslate"><span class="pre">find_peaks</span></code>, this parameter sets <em>the minimum prominence that a peak must have to be considered a unique peak</em> (rather than a shoulder of the larger peak). <strong>Often, tailored use of the prominence control alone is sufficient to cleanly identify peaks, so we don’t require any others.</strong> This is highlighted in the example below.</p></li>
</ul>
<p>We can see an example of analyzing NMR data below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">find_peaks</span>

<span class="c1"># define where our file can be found to be imported</span>
<span class="n">filepath</span>        <span class="o">=</span> <span class="s1">&#39;data/D1 AZTS crude.csv&#39;</span> <span class="c1"># sourced from E:\Dropbox (WilsonLab)\WilsonLab Team Folder\Projects\2021-04 - AZTS (SilKets) NCs\NMR</span>

<span class="c1"># import data, using our template from the previous section</span>
<span class="n">ppm</span><span class="p">,</span> <span class="n">signal</span>            <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span>
                                 <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                                 <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="n">skip_header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                 <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># first, truncate our data to our regions of interest</span>

<span class="n">truncsignal</span> <span class="o">=</span> <span class="n">signal</span><span class="p">[(</span><span class="n">ppm</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ppm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span> <span class="c1"># first, modify the y values to correspond to when the x values are less than 10 and greater than 0</span>
<span class="n">truncppm</span> <span class="o">=</span> <span class="n">ppm</span><span class="p">[(</span><span class="n">ppm</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ppm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>       <span class="c1"># then, modify the x values to correspond to when the x values are less than 10 and greater than 0</span>

<span class="c1"># plot the data</span>
    <span class="c1">#this time, we&#39;ll go back to using plt.plot so that you have a more-full example with this syntax</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">truncppm</span><span class="p">,</span><span class="n">truncsignal</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;truncated data&#39;</span><span class="p">)</span>


<span class="c1"># find peaks and plot them</span>
<span class="n">peaks</span> <span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">prominence</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ppm</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="n">signal</span><span class="p">[</span><span class="n">peaks</span><span class="p">],</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;peaks&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="c1"># Modify plot appearance</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># flip the x-axis left-to-right to adopt the conventional style for NMR plots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$\delta$ ppm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;intensity (arb.)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;1H NMR of AZTS NCs crude&#39;</span><span class="p">)</span> <span class="c1"># change title to match sample name</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span> <span class="c1"># show a legend with the labels we defined earlier</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;peaks located at &#39;</span><span class="p">,</span><span class="n">ppm</span><span class="p">[</span><span class="n">peaks</span><span class="p">])</span> <span class="c1"># print the ppm values of the peaks</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>peaks located at  [1.05098 1.06786 1.38916 2.10859 2.17466 3.46768 5.56162 6.95398 6.97258
 6.9973  7.01516 7.06386 7.08245]
</pre></div>
</div>
<img alt="_images/ab2de58e96b90a3b9cfd2ff9a621163feb18a6cfaca30b355c47f468f81bde71.png" src="_images/ab2de58e96b90a3b9cfd2ff9a621163feb18a6cfaca30b355c47f468f81bde71.png" />
</div>
</div>
</section>
<section id="background-subtraction">
<h2>Background subtraction<a class="headerlink" href="#background-subtraction" title="Permalink to this heading">#</a></h2>
<p>A very common correction you will need to do to experimental data is background subtraction. Some commercial software does this automatically, and only outputs the result. However other software/instruments first record a blank/background measurement, then record the data from your sample(s). This is often preferable in more-exploratory or demanding measurements, so that you can review the results of both measurment and perform the subtraction with care (either manually, or via a workflow.)</p>
<p>Sometimes background subtraction can be as simple as subtracting a constant amount from all your data. Returning to our fluorescence spectra example from the Importing Data page (which you can also see in the plot below as the red ‘raw’ trace), we see that there is a flat, positive signal that persists outside of the range of wavelengths where we would expect photoluminescence (mainly, &lt;300 nm and &gt;900 nm. In practice this signal arises from read noise and detector dark counts, and so does not reflect <em>real</em> fluorescence.) To address this, we would determine what is the average value of this background—lets say we do this and call the result <code class="docutils literal notranslate"><span class="pre">bg</span></code>. Then, we could subtract <code class="docutils literal notranslate"><span class="pre">bg</span></code> from <em>every</em> element in our intensity array (because such a background would add to the signal <em>everywhere</em>, even in spectral regions where we did detect light!). We can subtract a constant from every element of an array using the following manipulation:</p>
<p><code class="docutils literal notranslate"><span class="pre">intens</span> <span class="pre">=</span> <span class="pre">intens</span> <span class="pre">-</span> <span class="pre">bg</span></code></p>
<p>All this does is take every element of the <code class="docutils literal notranslate"><span class="pre">array</span></code> we defined as <code class="docutils literal notranslate"><span class="pre">intensity</span></code>, and subtract the value <code class="docutils literal notranslate"><span class="pre">bg</span></code> from it (which could be a number, e.g. 1565.) As an example, lets do this with the data we imported in the <strong>Importing Data</strong> module</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># define where our file can be found to be imported</span>
<span class="n">filepath</span>        <span class="o">=</span> <span class="s1">&#39;data/CdSe_EmissionSpectra.txt&#39;</span>

<span class="n">wavelengths</span><span class="p">,</span> <span class="n">intensities</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span>
                                 <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                                 <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="n">skip_header</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
                                 <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plot the raw data</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span><span class="n">intensities</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Raw Data&#39;</span><span class="p">)</span> <span class="c1"># plt.plot(xvalues, yvalues)</span>

<span class="c1"># estimate background by averaging the values in intensity that are beyond 900nm</span>
<span class="n">indexVal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">wavelengths</span><span class="o">&gt;</span><span class="mi">900</span><span class="p">)</span> <span class="c1"># finds the index of the first element in the `wavelengths` array that is greater than 900nm. We can then use this index to refer to data in the matched `intensities` array.</span>
<span class="n">bg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">intensities</span><span class="p">[</span><span class="n">indexVal</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># finds the average value of the elements in the intensities array between indexVal and the last element in the array (which we can always refer to in python by the index `-1`)</span>
<span class="n">bkSubIntensities</span> <span class="o">=</span> <span class="n">intensities</span> <span class="o">-</span> <span class="n">bg</span>     <span class="c1"># subtract background</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span><span class="n">bkSubIntensities</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Background-Subtracted&#39;</span><span class="p">)</span>
<span class="c1">#plt.xlim(400,900) #We could un-comment this to restrict the range of wavelengths that appear in the plot, if we wished.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (nm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity (arb.)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Emission Spectra of CdSe Quantum Dots: Before/after normalization&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1cc93d4fec8&gt;
</pre></div>
</div>
<img alt="_images/31851e2d900943d1ff4da29521a36d622020ee39ebba8971dc25250202bb347c.png" src="_images/31851e2d900943d1ff4da29521a36d622020ee39ebba8971dc25250202bb347c.png" />
</div>
</div>
</section>
<section id="normalization">
<h2>Normalization<a class="headerlink" href="#normalization" title="Permalink to this heading">#</a></h2>
<p>Another common practice when working with many types of data is <em>normalization</em>, where we wish to scale the data so that its maximum value is unity (i.e. <code class="docutils literal notranslate"><span class="pre">1</span></code>). This is especially the case when the absolute readings of an instrument don’t have special meaning (calibration can be challenging!), or if you want to compare the shape (rather than the magnitude) of a series of distinct measurements.</p>
<p>Given some array, for example the <code class="docutils literal notranslate"><span class="pre">itensities</span></code> array from the previous example with a fluorescence spectrum, simple normalization can be achieved in one line:
<code class="docutils literal notranslate"><span class="pre">normIntensities</span> <span class="pre">=</span> <span class="pre">intensities/max(intensities)</span></code></p>
<p>You can see how this works conceptually, the <code class="docutils literal notranslate"><span class="pre">max()</span></code> function returns the greatest value in the <code class="docutils literal notranslate"><span class="pre">intensities</span></code> array. We then divide (each element of) the array by this number, and store the result in <code class="docutils literal notranslate"><span class="pre">normIntensities</span></code>.</p>
<p>However, often we will only be interested in determining a local maximum to normalize to. (For instance, if there are large signals elsewhere in the array that we’re not interested in, perhaps because they arise from a different physical process, or instrumental noise.) Here, we can utilize truncation as described above to cause the <code class="docutils literal notranslate"><span class="pre">max</span></code> function to look for a maximum in a specified range.</p>
<p>To highlight this in action, let’s look at some <strong>UV-VIS absorption data</strong> and see the before and after plots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># define where our file can be found to be imported</span>
<span class="n">filepath</span>        <span class="o">=</span> <span class="s1">&#39;data/2020-02-11 ITK605 Absorption.csv&#39;</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span>            <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span>
                                 <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                                 <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span>
                                 <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                 <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plot raw data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;absorption data pre manipulation&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;absorption data pre manipulation&#39;)
</pre></div>
</div>
<img alt="_images/1a1e9db938fe2cfd3acf3cf0996e086b4b69893901926cabede9d3aa80cdc6d9.png" src="_images/1a1e9db938fe2cfd3acf3cf0996e086b4b69893901926cabede9d3aa80cdc6d9.png" />
</div>
</div>
<p>We can see from the figure above that the raw data is not incredibly useful, however with some simple manipulation we can make it much more fruitful. The instrument often has artifacts that we have to account for or exclude when analyzing data. Let’s see below what some simple manipulation can do!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># define where our file can be found to be imported</span>
<span class="n">filepath</span>        <span class="o">=</span> <span class="s1">&#39;data/2020-02-11 ITK605 Absorption.csv&#39;</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span>            <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span>
                                 <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                                 <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span>
                                 <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                 <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># first, truncate my data to 450 nm and beyond</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">450</span><span class="p">]</span> <span class="c1"># first, modify the y values to corruspond to when the x values are greater than 450</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">450</span><span class="p">]</span> <span class="c1"># then, modify the x values to corruspond to when the x values are greater than 450</span>

<span class="c1"># next, locate the local maximum that I know is around 600 nm</span>
<span class="n">local_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">550</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">650</span><span class="p">)]</span> <span class="c1"># truncate y values to x values between 600 and 610</span>
<span class="n">local_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">local_y</span><span class="p">)</span> <span class="c1"># find global maximum</span>

<span class="c1"># normalize by local maximum</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">local_max</span>

<span class="c1"># plot normalized data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;normalized&#39;</span><span class="p">)</span>

<span class="c1"># we can also subtract the background, however we usually do that before normalizing and wont do it here</span>

<span class="c1"># set plot labels and title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (nm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Absorption (au, norm.)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Absorption Spectrum of CdSe/ZnS core/shell Quantum Dots&#39;</span><span class="p">)</span>
<span class="c1"># set x and y limits</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">450</span><span class="p">,</span><span class="mi">800</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1493c70cc4a4a07bc0852d0ae4f4f4b2371c59a081ab9d9fc6cb91755652048e.png" src="_images/1493c70cc4a4a07bc0852d0ae4f4f4b2371c59a081ab9d9fc6cb91755652048e.png" />
</div>
</div>
<p>This is especially useful when comparing distinct spectra, such as in the case where we need to import multiple files.</p>
</section>
<section id="flipping-data">
<h2>Flipping data<a class="headerlink" href="#flipping-data" title="Permalink to this heading">#</a></h2>
<p>Sometimes, the order in which instruments record data is not necessarily how we want to plot it or analyze it. For example, let’s say we want to plot the emission by energy rather than wavelength. For reference, we can convert from wavelength of emission to energy in electronvolts by the following:</p>
<div class="math notranslate nohighlight">
\[
E_{\lambda} = \frac{1239.8}{\lambda}  \text{ eV}
\]</div>
<p>So we can easily plot emission intensity versus energy as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># define where our file can be found to be imported</span>
<span class="n">filepath</span>        <span class="o">=</span> <span class="s1">&#39;data/2020-02-11 ITK605 Absorption.csv&#39;</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span>            <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span>
                                 <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                                 <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span>
                                 <span class="n">skip_header</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                 <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plot raw data</span>

<span class="c1"># calculate a new energy array from wavelength array</span>
<span class="n">ev</span> <span class="o">=</span> <span class="mf">1239.8</span><span class="o">/</span><span class="n">x</span>

<span class="c1"># plot raw data by ev instead of wavelength</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ev</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="c1"># we can also subtract the background, however we usually do that before normalizing and wont do it here</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Absorption (a.u.)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Absorption Spectrum of CdSe/ZnS core/shell Quantum Dots&#39;</span><span class="p">)</span>

<span class="c1"># set axis limits</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/112d6eb299fb7085d0fa46047e6a225de293084ddd92ee1dbaf9c7dd3190de28.png" src="_images/112d6eb299fb7085d0fa46047e6a225de293084ddd92ee1dbaf9c7dd3190de28.png" />
</div>
</div>
<p>Generally we plot energy from highest to lowest, however by default <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> plots from lowest to highest values. This is common for many other plots, such as NMR plots which we will see later below. We can easily fix this by reversing the order of our axis limits to <code class="docutils literal notranslate"><span class="pre">plt.xlim(max,min)</span></code> rather than the typical min, max order. We can easily obtain the minimum and maximum values for our x-axis by calling <code class="docutils literal notranslate"><span class="pre">max(x)</span></code> and <code class="docutils literal notranslate"><span class="pre">min(x)</span></code> respectively, where <code class="docutils literal notranslate"><span class="pre">x</span></code> is whatever label we use for our x-data. See below for example</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ev</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="c1"># reverse x-axis, to go in descending order. Often used when plotting quantities related to energy.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ev</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">ev</span><span class="p">))</span>
<span class="c1"># or, if we want to specify the limits in terms of energy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Absorption (a.u.)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Absorption Spectrum of CdSe/ZnS core/shell Quantum Dots&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/10b73b0ca6782a6d115d5e4066f849a5361400d1fd18a51efbe483f614d8efc1.png" src="_images/10b73b0ca6782a6d115d5e4066f849a5361400d1fd18a51efbe483f614d8efc1.png" />
</div>
</div>
<p>Additionally, We also may want to do this with our data arrays themselves. To do this, we can simply use <code class="docutils literal notranslate"><span class="pre">np.flip</span></code> as below on our UV-VIS data for example</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;original array:&#39;</span><span class="p">,</span><span class="n">ev</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
<span class="n">ev_flipped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;flipped array:&#39;</span><span class="p">,</span><span class="n">ev_flipped</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>original array: [1.54975    1.55168961 1.55363409 1.55558344 1.55753769 1.55949686
 1.56146096 1.56343001 1.56540404 1.56738306]
flipped array: [4.9592     4.93944223 4.91984127 4.90039526 4.88110236 4.86196078
 4.84296875 4.82412451 4.80542636 4.78687259]
</pre></div>
</div>
</div>
</div>
<p>This is useful in case we want to work with our data in a specific order of values! But usually, just reversing the plot will be enough.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "Rees9/Py4PhysChem",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="ImportingData.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Importing Data into Python</p>
      </div>
    </a>
    <a class="right-next"
       href="plotting.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Visualizing Data in Python</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#truncating-data-with-boolean-logic">Truncating data with boolean logic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-peaks-scipy-find-peaks">Finding peaks: scipy.find_peaks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background-subtraction">Background subtraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#normalization">Normalization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#flipping-data">Flipping data</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Rees Hughes, Mark Wilson
</p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <div>
<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://licensebuttons.net/l/by-nc-sa/3.0/88x31.png"></a>
    All content on this site (unless otherwise specified) is licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0 license</a>
</div>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>